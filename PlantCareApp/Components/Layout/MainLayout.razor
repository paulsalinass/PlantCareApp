@inherits LayoutComponentBase
@inject IJSRuntime JsRuntime

<div class="app-shell @(isDarkMode ? "dark-mode" : null)">
    <aside class="sidebar @(isMobileNavOpen ? "open" : null)">
        <div class="sidebar-header">
            <a href="/" class="brand">
                <span class="brand-icon">
                    <i class="bi bi-flower3"></i>
                </span>
                <div>
                    <strong>PlantCare</strong>
                    <small>IA para tus plantas</small>
                </div>
            </a>
            <button class="btn btn-toggle-mode" type="button" @onclick="ToggleMode">
                <i class="bi @(isDarkMode ? "bi-sun" : "bi-moon") me-1"></i>
                @(isDarkMode ? "Claro" : "Oscuro")
            </button>
        </div>

        <nav class="sidebar-nav" @onclick="CloseMobileNav">
            <NavLink class="nav-link" href="/plants" Match="NavLinkMatch.Prefix">
                <span class="nav-icon">
                    <i class="bi bi-grid-1x2"></i>
                </span>
                Mis plantas
            </NavLink>
            <NavLink class="nav-link" href="/plants/add">
                <span class="nav-icon">
                    <i class="bi bi-plus-circle"></i>
                </span>
                Agregar planta
            </NavLink>
            <NavLink class="nav-link" href="/identify">
                <span class="nav-icon">
                    <i class="bi bi-camera"></i>
                </span>
                Identificar por foto
            </NavLink>
            <NavLink class="nav-link" href="/diagnosis">
                <span class="nav-icon">
                    <i class="bi bi-activity"></i>
                </span>
                Diagnostico
            </NavLink>
            <NavLink class="nav-link" href="/today">
                <span class="nav-icon">
                    <i class="bi bi-calendar-day"></i>
                </span>
                Hoy
            </NavLink>
            <NavLink class="nav-link" href="/dashboard">
                <span class="nav-icon">
                    <i class="bi bi-speedometer2"></i>
                </span>
                Dashboard
            </NavLink>
            <NavLink class="nav-link" href="/zones">
                <span class="nav-icon">
                    <i class="bi bi-house-heart"></i>
                </span>
                Mis ambientes
            </NavLink>
            <NavLink class="nav-link" href="/chat">
                <span class="nav-icon">
                    <i class="bi bi-chat-dots"></i>
                </span>
                Chat IA
            </NavLink>
            <NavLink class="nav-link" href="/weather">
                <span class="nav-icon">
                    <i class="bi bi-cloud-sun"></i>
                </span>
                Clima
            </NavLink>
            <NavLink class="nav-link" href="/notifications">
                <span class="nav-icon">
                    <i class="bi bi-bell"></i>
                </span>
                Notificaciones
            </NavLink>
            <NavLink class="nav-link" href="/profile">
                <span class="nav-icon">
                    <i class="bi bi-person"></i>
                </span>
                Perfil
            </NavLink>
        </nav>
    </aside>

    <div class="mobile-nav-overlay @(isMobileNavOpen ? "show" : null)" @onclick="CloseMobileNav"></div>

    <section class="main-area">
        <header class="mobile-topbar">
            <a href="/" class="brand topbar-brand">
                <span class="brand-icon compact">
                    <i class="bi bi-flower3"></i>
                </span>
                <div>
                    <strong>PlantCare</strong>
                    <small>IA para tus plantas</small>
                </div>
            </a>
        </header>

        <main class="content">
            <div class="content-inner">
                @Body
            </div>
        </main>
    </section>
    <nav class="mobile-bottom-nav">
        <NavLink class="bottom-nav-link" href="/today" Match="NavLinkMatch.Prefix">
            <i class="bi bi-calendar-check"></i>
            <span>Hoy</span>
        </NavLink>
        <NavLink class="bottom-nav-link" href="/plants" Match="NavLinkMatch.Prefix">
            <i class="bi bi-collection"></i>
            <span>Plantas</span>
        </NavLink>
        <NavLink class="bottom-nav-link" href="/plants/add">
            <span class="add-pill">
                <i class="bi bi-plus-lg"></i>
            </span>
            <span class="sr-only">Agregar</span>
        </NavLink>
        <NavLink class="bottom-nav-link" href="/diagnosis">
            <i class="bi bi-activity"></i>
            <span>Diagnóstico</span>
        </NavLink>
        <NavLink class="bottom-nav-link" href="/more">
            <i class="bi bi-grid"></i>
            <span>Más</span>
        </NavLink>
    </nav>
</div>

@code {
    private bool isDarkMode;
    private bool isMobileNavOpen;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            isDarkMode = await JsRuntime.InvokeAsync<bool>("plantCare.applySavedTheme");
            StateHasChanged();
        }
    }

    private async Task ToggleMode()
    {
        isDarkMode = await JsRuntime.InvokeAsync<bool>("plantCare.toggleTheme");
    }

    private void ToggleMobileNav()
    {
        isMobileNavOpen = !isMobileNavOpen;
    }

    private void CloseMobileNav() => isMobileNavOpen = false;
}
